(this["webpackJsonpanti-port-demo"]=this["webpackJsonpanti-port-demo"]||[]).push([[0],{100:function(e,t,a){},133:function(e,t,a){},134:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(35),s=a.n(i),o=(a(95),a(84)),c=a(18),l=a(155),u=a(160),m=a(165),f=a(166),d=a(164),h=a(163),p=a(162),b=a(3),g=a(10),v=a(12),x=a(13),y=a(7),E=new(function(){function e(){Object(v.a)(this,e),this.storage=void 0,this.storage=window.sessionStorage}return Object(x.a)(e,[{key:"read",value:function(e){try{return JSON.parse(this.storage.getItem(e))}catch(t){return{}}}},{key:"write",value:function(e,t){var a=JSON.stringify(t);this.storage.setItem(e,a)}}]),e}()),w=a(161),j=a(36),S=Object({NODE_ENV:"production",PUBLIC_URL:"/agora-web-showcase/examples/video-analytics",REACT_APP_AGORA_PASSWORD:"moderation",REACT_APP_AGORA_APP_ID:"aab8b8f5a8cd4469a63042fcfafe7063",REACT_APP_AGORA_APP_PROXY_TARGET:"https://webdemo.agora.io/moderation",REACT_APP_AGORA_APP_MODERATION_API_SERVICE:"https://webdemo.agora.io",REACT_APP_AGORA_APP_MODERATION_API_WEB_SOCKET:"wss://webdemo.agora.io/moderation/data",REACT_APP_AGORA_CDN_URL:"https://webdemo.agora.io/moderator",REACT_APP_AGORA_CDN:"https://webdemo.agora.io/moderator"}).REACT_APP_AGORA_APP_TOKEN,O=Object(y.a)({loading:!1,uid:0,peerUid:0,rid:"",roomName:"",token:S,resolution:"480p",mode:"live",codec:"h264",toast:Object(j.a)()},E.read("user")),N=new(function(){function e(){Object(v.a)(this,e),this.subject=void 0,this.state=O,this.subject=null}return Object(x.a)(e,[{key:"initialize",value:function(){this.subject=new w.a,this.commit(this.state)}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe()}},{key:"showLoading",value:function(){this.state=Object(y.a)({},this.state,{loading:!0}),this.commit(this.state)}},{key:"stopLoading",value:function(){this.state=Object(y.a)({},this.state,{loading:!1}),this.commit(this.state)}},{key:"toastError",value:function(e){this.state=Object(y.a)({},this.state,{toast:this.state.toast.push({variant:"error",message:e})}),this.commit(this.state)}},{key:"toastInfo",value:function(e){this.state=Object(y.a)({},this.state,{toast:this.state.toast.push({variant:"info",message:e})}),this.commit(this.state)}},{key:"toastSuccess",value:function(e){this.state=Object(y.a)({},this.state,{toast:this.state.toast.push({variant:"success",message:e})}),this.commit(this.state)}},{key:"updateRoom",value:function(e){this.state=Object(y.a)({},this.state,{roomName:e}),this.commit(this.state)}},{key:"clear",value:function(){this.state=O,this.commit(this.state)}},{key:"updateUid",value:function(e){this.state=Object(y.a)({},this.state,{uid:e,peerUid:e+1}),this.commit(this.state)}}]),e}()),C=r.a.createContext({}),k=function(){return r.a.useContext(C)},I=function(e){var t=e.children,a=r.a.useState(O),n=Object(g.a)(a,2),i=n[0],s=n[1],o=r.a.useRef(!1);r.a.useEffect((function(){return N.subscribe((function(e){!o.current&&s(e)})),function(){o.current=!0,N.unsubscribe()}}),[]),r.a.useEffect((function(){E.write("user",{uid:i.uid,peerUid:i.peerUid,roomName:i.roomName})}),[i.uid,i.peerUid,i.roomName]),window.state=i;var c=i;return r.a.createElement(C.Provider,{value:c},t)},A={message:""},R=new(function(){function e(){Object(v.a)(this,e),this.subject=void 0,this.state=void 0,this.state=A,this.subject=null}return Object(x.a)(e,[{key:"initialize",value:function(){this.state=A,this.subject=new w.a,this.subject.next(this.state)}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"subscribe",value:function(e){this.initialize(),this.subject&&this.subject.subscribe(e)}},{key:"unsubscribe",value:function(){this.subject&&this.subject.unsubscribe(),this.subject=null}},{key:"addMessage",value:function(e){this.state=Object(y.a)({},this.state,{message:e}),this.commit(this.state)}}]),e}());window.toast=R;var _=a(158);var P=Object(l.a)((function(e){return{fontStyle:{color:"#9ee2ff"},midItem:{marginTop:"1rem",marginBottom:"6rem"},item:{flex:1,display:"flex",alignItems:"center"},coverLeft:{background:"linear-gradient(to bottom, #307AFF, 50%, #46cdff)",alignItems:"center",flex:1,display:"flex",flexDirection:"column"},coverContent:{display:"flex",justifyContent:"center",flexDirection:"column",color:"#fff"},container:{display:"flex",justifyContent:"center",alignItems:"center"},card:{display:"flex",minWidth:700,minHeight:500,maxHeight:500,borderRadius:"10px",boxShadow:"0px 6px 18px 0px rgba(0,0,0,0.2)"},input:{maxWidth:"250px",minWidth:"250px",alignSelf:"center"},grid:{margin:"0 !important"},button:{lineHeight:"21px",color:"rgba(255,255,255,1)",fontSize:"17px",textTransform:"none",height:"44px",width:"260px","&:hover":{backgroundColor:"#82C2FF"},margin:e.spacing(1),marginTop:"33px",backgroundColor:"#44a2fc",borderRadius:"30px"},radio:{padding:"0",fontSize:"14px",alignItems:"center",paddingRight:"5px"}}})),T=Object(l.a)((function(e){return{formInput:{"&:after":{borderBottom:"1px solid #44a2fc"}}}}));function D(){var e=P(),t=Object(c.f)(),a=k(),n=T();return r.a.createElement(u.a,{flex:"1",display:"flex",alignItems:"center",justifyContent:"flex-start",flexDirection:"column"},r.a.createElement(u.a,{marginTop:"92",flex:"1",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},r.a.createElement(f.a,{className:Object(b.a)(e.input,e.grid)},r.a.createElement(d.a,{htmlFor:"channelName"},"Pick a topic to chat"),r.a.createElement(h.a,{className:n.formInput,id:"channelName",name:"channelName",value:a.roomName,onChange:function(e){var t=e.target.value.match(/^[a-zA-Z0-9]*/)[0];N.updateRoom(t||"")}})),r.a.createElement(f.a,{className:e.grid},r.a.createElement(p.a,{onClick:function(e){e.preventDefault(),a.roomName?(N.updateUid(+Date.now()%1e6),t.push({pathname:"/meeting/".concat(a.roomName)})):R.addMessage("Your need enter the topic")},variant:"contained",color:"primary",className:e.button},"Start Live Broadcast"))))}var F=Object(l.a)((function(e){return{fontStyle:{color:"#9ee2ff"},midItem:{fontSize:"28px",marginTop:"1rem",marginBottom:"6rem"},item:{flex:1,display:"flex",alignItems:"center"},coverLeft:{background:"linear-gradient(to bottom, #307AFF, 50%, #46cdff)",alignItems:"center",flex:1,display:"flex",flexDirection:"column"},coverContent:{display:"flex",justifyContent:"center",flexDirection:"column",color:"#fff"},coverRight:{position:"relative",flex:1,display:"flex"},container:{display:"flex",justifyContent:"center",alignItems:"center"},card:{display:"flex",minWidth:700,minHeight:500,maxHeight:500,borderRadius:"10px",boxShadow:"0px 6px 18px 0px rgba(0,0,0,0.2)"},input:{maxWidth:"250px",minWidth:"250px",alignSelf:"center"},grid:{margin:"0 !important"},button:{height:"44px",width:"260px","&:hover":{backgroundColor:"#307AFF"},margin:e.spacing(1),marginTop:"33px",backgroundColor:"#44a2fc",borderRadius:"30px"}}})),L=function(){var e=F();return r.a.createElement(u.a,{display:"flex",alignItems:"center",justifyContent:"center"},r.a.createElement(m.a,{className:e.card},r.a.createElement(u.a,{display:"flex",flex:"1"},r.a.createElement("div",{className:e.coverLeft},r.a.createElement("div",{className:e.item},r.a.createElement("div",{className:"cover-image"})),r.a.createElement("div",{className:e.item},r.a.createElement("div",{className:e.coverContent},r.a.createElement(u.a,{textAlign:"center",fontSize:"h6.fontSize",className:e.fontStyle},"Welcome to"),r.a.createElement(u.a,{textAlign:"center",fontWeight:"fontWeightRegular",fontSize:"h4.fontSize",className:e.midItem},"VIDEO MODERATION"),r.a.createElement(u.a,{textAlign:"center",fontWeight:"fontWeightRegular",className:e.fontStyle,fontSize:"h7.fontSize"},"Powered by Agora.io")))),r.a.createElement("div",{className:e.coverRight},r.a.createElement(D,null)))))},B=(Object(l.a)((function(e){return{fontStyle:{color:"#9ee2ff"},midItem:{marginTop:"1rem",marginBottom:"6rem"},item:{flex:1,display:"flex",alignItems:"center"},coverLeft:{background:"linear-gradient(to bottom, #307AFF, 50%, #46cdff)",alignItems:"center",flex:1,display:"flex",flexDirection:"column"},coverContent:{display:"flex",justifyContent:"center",flexDirection:"column",color:"#fff"},coverRight:{position:"relative",flex:1,display:"flex"},container:{display:"flex",justifyContent:"center",alignItems:"center"},card:{display:"flex",minWidth:700,minHeight:500,maxHeight:500,borderRadius:"10px",boxShadow:"0px 6px 18px 0px rgba(0,0,0,0.2)"},input:{maxWidth:"250px",minWidth:"250px",alignSelf:"center"},grid:{margin:"0 !important"},button:{height:"44px",width:"260px","&:hover":{backgroundColor:"#307AFF"},margin:e.spacing(1),marginTop:"33px",backgroundColor:"#3AB7F8",borderRadius:"30px"}}})),Object(l.a)((function(){return{container:{height:"100%",width:"100%",minWidth:800,minHeight:600,boxSizing:"content-box",display:"flex",justifyContent:"center"}}}))),z=r.a.memo((function(){var e=k(),t=B();return r.a.useEffect((function(){e.loading&&N.stopLoading()}),[e.loading]),r.a.createElement(_.a,{maxWidth:"sm",className:t.container},r.a.createElement(L,null))})),W=(a(100),a(83)),U=a.n(W),M=a(55),H=a.n(M),Y=a(5),G=a.n(Y),J=a(29),q=a(27),V=a(30),K=a(22),X=a.n(K),Z=a(53);function $(e){try{return JSON.parse(e)}catch(t){return void console.warn(t)}}var Q=new(function(e){function t(){var e;return Object(v.a)(this,t),(e=Object(J.a)(this,Object(q.a)(t).call(this))).resp=void 0,e.socket=void 0,e.sessionId=void 0,e.resp={},e.socket=null,e.sessionId="",e}return Object(V.a)(t,e),Object(x.a)(t,[{key:"startJob",value:function(e){var t,a,n,r,i,s;return G.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return e.uid,t=e.cname,a=e.peer_uid,n=e.interval,o.next=3,G.a.awrap(fetch("".concat("https://webdemo.agora.io","/moderation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventType:"start",callbackParam:{},pushFile:1,uid:"".concat(a),cname:t,interval:n})}));case 3:return r=o.sent,o.next=6,G.a.awrap(r.json());case 6:return i=o.sent,s={resultCode:X.a.get(i,"resultCode",null),msg:X.a.get(i,"msg"),sessionId:X.a.get(i,"sessionId"),wsAddress:X.a.get(i,"wsAddress")},o.abrupt("return",s);case 9:case"end":return o.stop()}}))}},{key:"connect",value:function(e){var t,a=this;return G.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,G.a.awrap(this.startJob(e));case 2:if(0===(t=n.sent).resultCode){n.next=5;break}throw{reason:"enable moderation failed"};case 5:this.socket=new WebSocket("".concat("wss://webdemo.agora.io/moderation/data")),this.socket.onopen=function(e){a.socket&&(a.sessionId=t.sessionId,a.socket.send(JSON.stringify({sessionId:t.sessionId,eventType:"join"}))),a.emit("open",e)},this.socket.onclose=function(e){a.emit("close",e)},this.socket.onmessage=function(e){var t=$(e.data.toString());"string"===typeof t&&(t=$(t)),a.emit("message",{data:t})},this.socket.onerror=function(e){a.emit("error",e)};case 10:case"end":return n.stop()}}),null,this)}},{key:"disconnect",value:function(){return G.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:this.socket&&(this.sessionId&&this.socket.send(JSON.stringify({sessionId:this.sessionId,eventType:"quit"})),this.socket.close());case 1:case"end":return e.stop()}}),null,this)}}]),t}(Z.EventEmitter));window.data=Q;var ee,te=a(85),ae=a(41),ne=a.n(ae),re=ne()("moderation".toLowerCase()),ie=function(){var e=document.querySelector("canvas").getContext("2d");return e?e.getImageData(0,0,299,299).data.byteLength:0},se={items:Object(j.b)()},oe=r.a.createContext({}),ce=r.a.memo((function(e){var t=e.children,a=r.a.useState(se),n=Object(g.a)(a,2),i=n[0],s=n[1];return r.a.useEffect((function(){return Q.on("open",(function(e){})),Q.on("close",(function(e){})),Q.on("message",(function(e){var t=e.data;if("join succeed"===t.errorMsg);else if("quit succeed"===t.errorMsg);else if(t&&t.results&&t.object){var a=t.object,n=(a.split("_")[1],a.split("__uid_s_")[1].split("__uid_e_")[0]),r=X.a.get(t,"results.porn.outputs"),o=r.porn,c=r.sexy,l=r.neutral,u=X.a.get(t,"results.porn.scene",""),m=X.a.get(t,"suggestion",""),f=a.split("__uid_e_")[1].split("_")[0],d=a.split("".concat(f,"_"))[1].split(".rgb")[0];!function(e,t){var a,n,r,i,s,o,c,l,u,m,f,d;G.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:return(a=ie())||console.warn("canvas not mounted"),h.next=4,G.a.awrap(fetch(e,{method:"GET"}));case 4:return n=h.sent,h.next=7,G.a.awrap(n.blob());case 7:return r=h.sent,h.next=10,G.a.awrap(r.arrayBuffer());case 10:for(i=h.sent,s=new Uint8Array(i),o=new Uint8ClampedArray(a),c=0;c<299;c++)for(l=0;l<299;l++)m=3*(u=299*c+l),o[(f=4*u)+0]=s[m+0],o[f+1]=s[m+1],o[f+2]=s[m+2],o[f+3]=255;return d=Object(te.a)({data:new Uint8Array(o.buffer),height:299,width:299}),h.next=17,G.a.awrap(new Promise((function(e,a){var n=new FileReader;n.onload=function(a){var n=a.currentTarget.result,r=document.getElementById(t);r?(r.src=n,r.complete&&e(n)):(console.warn("img is empty, domId: ",t),e())},n.readAsDataURL(new Blob([d],{type:"image/png"}))})));case 17:case"end":return h.stop()}}))}("".concat("https://webdemo.agora.io/moderator","/").concat(a),"preview-img-".concat(n)),s({items:i.items.set(+n,{uid:+n,porn:o,sexy:c,neutral:l,scene:u,suggestion:m,time:d,object:a})})}})),Q.on("error",(function(e){console.log("error",e)})),function(){Q.removeAllListeners()}}),[]),r.a.createElement(oe.Provider,{value:i},t)})),le=r.a.memo((function(e){var t=e.domId,a=e.stream,n=e.streamID,i=(e.local,e.profile),s=(e.result,r.a.useRef(!1)),o=r.a.useRef(!1),c=r.a.useState(!1),l=Object(g.a)(c,2),u=l[0],m=l[1],f=r.a.useContext(oe),d=r.a.useState({porn:0,time:0,sexy:0,neutral:0,suggestion:"",scene:""}),h=Object(g.a)(d,2),p=h[0],b=h[1];r.a.useEffect((function(){if(n&&f.items.get(n)){var e=f.items.get(n);e&&b(Object(y.a)({},p,{time:e.time,porn:e.porn,sexy:e.sexy,neutral:e.neutral,scene:e.scene,suggestion:e.suggestion}))}}),[n,f.items]),r.a.useEffect((function(){if(a)return!a||s.current||a.isPlaying()?void 0:(s.current=!0,a.play(t,{fit:"cover"},(function(e){s.current=!1,e&&"aborted"!==e.status&&(console.warn("agora stream play failed ",e),!s.current&&m(!0)),e&&console.warn(e)})),function(){a.isPlaying()&&a.stop()})}),[a]);var v=r.a.useCallback((function(){if(p.time){var e=H.a.tz(""+H()(p.time,"YYYYMMDDHHmmssSSS").format("YYYY/MM/DD HH:mm:ss"),H.a.tz.guess()).format("YYYY/MM/DD HH:mm:ss");return r.a.createElement("div",{className:"date"},e)}return r.a.createElement("div",{className:"date"})}),[p.time]),x=function(e){return Math.floor(1e7*e)/1e7},E=r.a.useCallback((function(){if(!n)return null;var e="number"===typeof p.porn?100*p.porn:p.porn,t="number"===typeof p.sexy?100*p.sexy:p.sexy,a="number"===typeof p.neutral?100*p.neutral:p.neutral;return r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"detail"},r.a.createElement("div",null,"Scene: ",p.scene),r.a.createElement("div",null,"Porn (",x(e),"%)"),r.a.createElement("div",null,"Sexy (",x(t),"%)"),r.a.createElement("div",null,"Neutral (",x(a),"%)")))}),[p,n]);return r.a.createElement("div",{className:"item"},r.a.createElement("div",{className:"player",id:t,onClick:function(){u&&!o.current&&(a.resume(),o.current=!0)}}),i&&p.suggestion?r.a.createElement("div",{className:"score-info"},r.a.createElement("img",{className:"preview-video-frame",id:"preview-img-".concat(n)}),r.a.createElement("div",{className:"table"},r.a.createElement("div",{className:"main-title"},p.suggestion?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:""},"Suggestion: "),r.a.createElement("span",{className:"".concat(p.suggestion," capitalize")},p.suggestion)):null),r.a.createElement(v,null),r.a.createElement(E,null))):null)})),ue=a(63),me=a.n(ue),fe=["error","exception","network-quality","peer-leave","stream-subscribed","stream-added","stream-removed","stream-published","connection-state-changed"];!function(e){e[e.DISCONNECTED=1]="DISCONNECTED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED"}(ee||(ee={}));var de={init:!1,join:!1,publish:!1,connectState:ee.DISCONNECTED,localStream:null,remoteStreams:Object(j.b)()},he=new(function(e){function t(){var e;return Object(v.a)(this,t),(e=Object(J.a)(this,Object(q.a)(t).call(this))).client=void 0,e.localStream=void 0,e.state=de,e.subject=void 0,e.events=[],e.client=me.a.createClient({mode:"rtc",codec:"h264"}),e.subject=null,e.localStream=null,e}return Object(V.a)(t,e),Object(x.a)(t,[{key:"initialize",value:function(){this.subject=new w.a,this.subject.next(this.state)}},{key:"subscribe",value:function(e){try{this.initialize(),this.subject&&this.subject.subscribe(e)}catch(t){console.warn(t)}}},{key:"unsubscribe",value:function(){try{this.subject&&this.subject.unsubscribe(),this.subject=null}catch(e){console.warn(e)}}},{key:"commit",value:function(e){this.subject&&this.subject.next(e)}},{key:"init",value:function(){var e=this;return G.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G.a.awrap(new Promise((function(t,a){e.client.init("aab8b8f5a8cd4469a63042fcfafe7063",(function(){e.state=Object(y.a)({},e.state,{init:!0}),e.commit(e.state),t()}),a)})));case 2:case"end":return t.stop()}}))}},{key:"subscribeClientEvents",value:function(){var e=this,t=!0,a=!1,n=void 0;try{for(var r,i=function(){var t=r.value;e.events.push(t),e.client.on(t,(function(a){e.emit(t,a)}))},s=fe[Symbol.iterator]();!(t=(r=s.next()).done);t=!0)i()}catch(o){a=!0,n=o}finally{try{t||null==s.return||s.return()}finally{if(a)throw n}}}},{key:"unsubscribeClientEvents",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,r=this.events[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var i=n.value;this.client.off(i,(function(){}))}}catch(s){t=!0,a=s}finally{try{e||null==r.return||r.return()}finally{if(t)throw a}}this.events=[]}},{key:"join",value:function(e,t){var a=this;return G.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,G.a.awrap(new Promise((function(n,r){var i=a;i.on("error",(function(e){console.warn("error",e)})),i.on("exception",(function(e){console.warn("exception",e)})),i.on("peer-leave",(function(e){i.removeRemote(e.uid)})),i.on("stream-subscribed",(function(e){var t=e.stream.getId();i.addRemoteStreams(t,e.stream)})),i.on("stream-added",(function(e){console.log(" peer stream ",e.stream.getId()),i.client.subscribe(e.stream,{audio:!0,video:!0})})),i.on("stream-removed",(function(e){i.removeRemote(e.stream.getId())})),i.on("stream-published",(function(e){console.log("stream published",e.stream),i.addLocal(e.stream)})),i.on("connection-state-change",(function(e){})),a.subscribeClientEvents(),a.client.join(null,t,e,(function(){a.state=Object(y.a)({},a.state,{join:!0}),a.commit(a.state),n()}),r)})));case 2:case"end":return n.stop()}}))}},{key:"leave",value:function(){var e=this;return G.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G.a.awrap(new Promise((function(t,a){e.unsubscribeClientEvents(),e.client.leave((function(){e.state=Object(y.a)({},e.state,{join:!1,publish:!1}),e.commit(e.state),t()}),a)})));case 2:case"end":return t.stop()}}))}},{key:"createLocalStream",value:function(e){var t,a=this;return G.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=me.a.createStream({video:!0,audio:!0,microphoneId:"",cameraId:"",streamID:e,mirror:!1}),n.next=3,G.a.awrap(new Promise((function(e,n){t.init((function(){a.localStream=t,e()}),n)})));case 3:case"end":return n.stop()}}))}},{key:"publish",value:function(){var e=this;return G.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G.a.awrap(new Promise((function(t,a){e.localStream&&(e.client.publish(e.localStream,a),setTimeout((function(){e.state=Object(y.a)({},e.state,{publish:!0}),e.commit(e.state),t()}),300)),t()})));case 2:case"end":return t.stop()}}))}},{key:"unpublish",value:function(){return G.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:this.localStream&&this.localStream.close(),this.localStream=null,this.remoteAllStreams();case 3:case"end":return e.stop()}}),null,this)}},{key:"startBroadcasting",value:function(e,t){return G.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,G.a.awrap(this.init());case 2:return a.next=4,G.a.awrap(this.join(e,t));case 4:return a.next=6,G.a.awrap(this.createLocalStream(e));case 6:return a.next=8,G.a.awrap(this.publish());case 8:case"end":return a.stop()}}),null,this)}},{key:"stopBroadcasting",value:function(){return G.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.removeAllListeners(),e.next=3,G.a.awrap(this.unpublish());case 3:return e.next=5,G.a.awrap(this.leave());case 5:case"end":return e.stop()}}),null,this)}},{key:"addLocal",value:function(e){this.state=Object(y.a)({},this.state,{localStream:e}),this.commit(this.state)}},{key:"removeLocal",value:function(){this.state.localStream&&this.state.localStream.close(),this.state=Object(y.a)({},this.state,{localStream:null}),this.commit(this.state)}},{key:"addRemoteStreams",value:function(e,t){this.state=Object(y.a)({},this.state,{remoteStreams:this.state.remoteStreams.set(e,t)}),this.commit(this.state)}},{key:"removeRemote",value:function(e){var t=this.state.remoteStreams.get(e);t&&t.isPlaying()&&t.stop(),this.state=Object(y.a)({},this.state,{remoteStreams:this.state.remoteStreams.delete(e)}),this.commit(this.state)}},{key:"remoteAllStreams",value:function(){this.removeLocal(),this.state.remoteStreams.forEach((function(e){e.isPlaying()&&e.stop()}))}}]),t}(Z.EventEmitter));window.webClient=he;var pe=r.a.createContext({}),be=function(e){var t=e.children,a=r.a.useState(de),n=Object(g.a)(a,2),i=n[0],s=n[1],o=r.a.useRef(!1);return r.a.useEffect((function(){return he.subscribe((function(e){!o.current&&s(e)})),function(){o.current=!0,he.unsubscribe(),he.stopBroadcasting().then((function(){})).catch(console.warn)}}),[]),r.a.useEffect((function(){window.mediaState=i}),[i]),r.a.createElement(pe.Provider,{value:i},t)},ge=U()((function(e){return{confirmBtn:{lineHeight:"22px",color:"rgba(255,255,255,1)",fontSize:"16px",textTransform:"none",height:"40px",width:"120px","&:hover":{backgroundColor:"#82C2FF"},backgroundColor:"#3AB7F8",borderRadius:"2px",marginLeft:"10px"},stopBtn:{lineHeight:"22px",color:"#3AB7F8",fontSize:"16px",textTransform:"none",height:"40px",width:"120px","&:hover":{backgroundColor:"#FFFFFF"},backgroundColor:"#FFFFFF",marginLeft:"10px",border:"1px solid rgba(204,204,204,1)",borderRadius:"2px"},leaveBtn:{marginTop:"37px",lineHeight:"22px",backgroundColor:"rgba(255,255,255,1)",color:"#3AB7F8",fontSize:"16px",textTransform:"none",height:"40px",width:"310px","&:hover":{backgroundColor:"rgba(255,255,255,1)"},border:"1px solid rgba(204,204,204,1)",borderRadius:"2px"}}})),ve=function(){var e=Object(c.f)(),t=k(),a=r.a.useContext(pe),n=r.a.useRef(!1),i=r.a.useState(!1),s=Object(g.a)(i,2),o=s[0],l=s[1],u=r.a.useState(""),m=Object(g.a)(u,2),f=m[0],d=m[1],h=r.a.useState(localStorage.getItem("passwd")?localStorage.getItem("passwd"):""),b=Object(g.a)(h,2),v=b[0],x=b[1],y=r.a.useState(),E=Object(g.a)(y,2),w=E[0],j=E[1],S=r.a.useState(5),O=Object(g.a)(S,2),C=O[0],I=O[1],A=r.a.useRef(5);r.a.useEffect((function(){return function(){n.current=!0}}),[]),r.a.useEffect((function(){v&&localStorage.setItem("passwd",v)}),[v]),r.a.useEffect((function(){if(!t.roomName||!t.uid||!t.peerUid)return R.addMessage("Please enter the channel name first"),void e.push("/");if(o){!n.current&&N.showLoading();var a=ne()("".concat(Date.now()).concat(t.roomName));return Promise.all([he.startBroadcasting(t.uid,a),Q.connect({uid:t.uid,cname:a,peer_uid:t.peerUid,interval:+A.current})]).then((function(){})).catch(console.warn).finally((function(){!n.current&&N.stopLoading()})),function(){!n.current&&N.showLoading(),Promise.all([he.stopBroadcasting(),Q.disconnect()]).then((function(){})).catch(console.warn).finally((function(){!n.current&&N.stopLoading()}))}}}),[t.roomName,t.uid,t.peerUid,o]);var _=ge(),P=function(t){if("leave"===t&&e.push({pathname:"/"}),"start"===t){var a=f.toLowerCase();if(v===re)return A.current=C,void l(!0);if(!a||ne()(a)!==re)return void j("password invalid");x(ne()(a)),A.current=C,l(!0)}"stop"===t&&l(!1)},T=r.a.useCallback((function(){return a.localStream?r.a.createElement(le,{domId:"local",local:!0,profile:o,streamID:a.localStream.getId(),stream:a.localStream}):r.a.createElement(le,{profile:o,domId:"local-placeholder",local:!0})}),[a.localStream,o]),D=r.a.useCallback((function(){var e=a.remoteStreams.get(t.peerUid);return e?r.a.createElement(le,{domId:"remote",streamID:e.getId(),stream:e,profile:o}):r.a.createElement(le,{domId:"remote-placeholder",profile:o})}),[a.remoteStreams,t.peerUid,o]);return r.a.createElement("div",{className:"meeting-container"},r.a.createElement("div",{className:"nav"},r.a.createElement("a",{className:"agora-logo",href:"https://www.agora.io",target:"_blank"})),r.a.createElement("div",{className:"content-container"},r.a.createElement("div",{className:"video-list"},r.a.createElement(T,null),r.a.createElement(D,null)),r.a.createElement("div",{className:"form-container"},v!==re?r.a.createElement("div",{className:"items"},r.a.createElement("h5",{className:"field-label",style:{marginBottom:0}},"Code"),r.a.createElement("span",{className:"validator ".concat(w?"":"hidden")},w),r.a.createElement("input",{type:"text",name:"pwd",value:f,className:"input",placeholder:"enter your passwd",onChange:function(e){d(e.target.value)}})):null,r.a.createElement("div",{className:"items"},r.a.createElement("h5",{className:"field-label"},"Moderation Config"),r.a.createElement("div",{className:"item"},r.a.createElement("input",{type:"number",min:"5",value:C,defaultValue:C,placeholder:"interval (seconds)",className:"input",disabled:o,onChange:function(e){e.preventDefault(),e.target.value<5?I(5):I(e.target.value)}}),o?r.a.createElement(p.a,{onClick:function(){return P("stop")},color:"primary",className:_.stopBtn},"stop"):r.a.createElement(p.a,{onClick:function(){return P("start")},color:"primary",className:_.confirmBtn},"start"))),r.a.createElement("div",{className:"item"},r.a.createElement(p.a,{onClick:function(){return P("leave")},color:"primary",className:_.leaveBtn},"LeaveChannel")))))},xe=r.a.memo((function(){return r.a.createElement(be,null,r.a.createElement(ce,null,r.a.createElement(ve,null)))})),ye=a(159),Ee=Object(l.a)((function(e){return{progress:{margin:e.spacing(2),color:"#44A2FC"},container:{position:"absolute",top:"0px",left:"0px",height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",background:"#ffffff",opacity:.8,zIndex:10}}})),we=function(){var e=Ee();return r.a.createElement("div",{className:e.container},r.a.createElement(ye.a,{className:e.progress}))},je=function(){var e=k();return Object(n.useMemo)((function(){return e.loading}),[e.loading])?r.a.createElement(we,null):null},Se=a(64);a(133);var Oe=r.a.memo((function(e){var t=e.duration,a=void 0===t?1500:t,i=Ce().message,s=r.a.useRef([]),o=Object(n.useState)([]),c=Object(g.a)(o,2),l=c[0],u=c[1],m=Object(n.useRef)(null);return Object(n.useEffect)((function(){l.length>0&&null===m.current&&(m.current=setTimeout((function(){s.current.shift(),R.addMessage(""),u(Object(Se.a)(s.current)),m.current=null}),a))}),[l]),Object(n.useEffect)((function(){s.current&&i&&(s.current.push({message:i,key:+Date.now()}),u(Object(Se.a)(s.current)))}),[i]),r.a.createElement("div",{className:"notice-message-container"},l.map((function(e,t){return r.a.createElement("div",{key:"".concat(t).concat(e.key),className:"custom-toast"},r.a.createElement("div",{className:"toast-container"},r.a.createElement("span",{className:"text"},e.message)))})))})),Ne=r.a.createContext({}),Ce=function(){return r.a.useContext(Ne)},ke=r.a.memo((function(e){e.children;var t=r.a.useState(A),a=Object(g.a)(t,2),n=a[0],i=a[1],s=r.a.useRef(!1);r.a.useEffect((function(){return R.subscribe((function(e){!s.current&&i(e)})),function(){s.current=!0,R.unsubscribe()}}),[]);var o=n;return r.a.createElement(Ne.Provider,{value:o},r.a.createElement(Oe,{duration:800}))})),Ie=function(){return r.a.createElement(o.a,null,r.a.createElement(c.c,null,r.a.createElement(I,null,r.a.createElement(je,null),r.a.createElement(ke,null),r.a.createElement(c.a,{path:"/",component:z,exact:!0}),r.a.createElement(c.a,{path:"/meeting/:name",component:xe,exact:!0}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(Ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},90:function(e,t,a){e.exports=a(134)},95:function(e,t,a){}},[[90,1,2]]]);
//# sourceMappingURL=main.c7612b72.chunk.js.map